<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f0f1a">
    <meta name="description" content="Python Syntax Card Game - A 1v1 card battle game where you build Python code sequences">
    <title>Python Syntax Card Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Auth Header Bar -->
    <div class="auth-header" id="authHeader">
        <div class="auth-header-content">
            <div class="auth-status" id="authStatus">
                <!-- Will be populated by JS based on auth state -->
            </div>
        </div>
    </div>
    
    <!-- Auth Modal -->
    <div class="auth-modal-overlay" id="authModalOverlay">
        <div class="auth-modal">
            <button class="auth-modal-close" id="authModalClose">&times;</button>
            
            <div class="auth-modal-header">
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="login">Login</button>
                    <button class="auth-tab" data-tab="register">Register</button>
                </div>
            </div>
            
            <div class="auth-modal-body">
                <!-- Login Form -->
                <form id="loginForm" class="auth-form active">
                    <div class="auth-form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" placeholder="your@email.com" required>
                    </div>
                    <div class="auth-form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Password" required minlength="6">
                    </div>
                    <div class="auth-error" id="loginError"></div>
                    <button type="submit" class="auth-submit-btn">
                        <span class="btn-text">Login</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="loading-spinner-small"></span>
                            Logging in...
                        </span>
                    </button>
                </form>
                
                <!-- Register Form -->
                <form id="registerForm" class="auth-form">
                    <div class="auth-form-group">
                        <label for="registerName">Display Name</label>
                        <input type="text" id="registerName" placeholder="YourNickname" maxlength="30">
                    </div>
                    <div class="auth-form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" placeholder="your@email.com" required>
                    </div>
                    <div class="auth-form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" placeholder="Min 6 characters" required minlength="6">
                    </div>
                    <div class="auth-form-group">
                        <label for="registerPasswordConfirm">Confirm Password</label>
                        <input type="password" id="registerPasswordConfirm" placeholder="Confirm password" required minlength="6">
                    </div>
                    <div class="auth-error" id="registerError"></div>
                    <button type="submit" class="auth-submit-btn">
                        <span class="btn-text">Create Account</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="loading-spinner-small"></span>
                            Creating...
                        </span>
                    </button>
                </form>
            </div>
            
            <div class="auth-modal-footer">
                <p class="auth-note">Play without an account, or sign up to track your stats!</p>
            </div>
        </div>
    </div>
    
    <!-- Profile Modal -->
    <div class="profile-modal-overlay" id="profileModalOverlay">
        <div class="profile-modal">
            <button class="auth-modal-close" id="profileModalClose">&times;</button>
            
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">üë§</div>
                <h2 class="profile-name" id="profileName">Player</h2>
                <p class="profile-email" id="profileEmail">email@example.com</p>
            </div>
            
            <div class="profile-stats">
                <div class="stat-item">
                    <span class="stat-value" id="statGamesPlayed">0</span>
                    <span class="stat-label">Games</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="statGamesWon">0</span>
                    <span class="stat-label">Wins</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="statWinRate">0%</span>
                    <span class="stat-label">Win Rate</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="statHighScore">0</span>
                    <span class="stat-label">Best Score</span>
                </div>
            </div>
            
            <div class="profile-actions">
                <button class="profile-btn secondary" id="viewLeaderboardBtn">
                    <span>üèÜ</span> Leaderboard
                </button>
                <button class="profile-btn danger" id="logoutBtn">
                    <span>üö™</span> Logout
                </button>
            </div>
        </div>
    </div>
    
    <!-- Leaderboard Modal -->
    <div class="leaderboard-modal-overlay" id="leaderboardModalOverlay">
        <div class="leaderboard-modal">
            <button class="auth-modal-close" id="leaderboardModalClose">&times;</button>
            
            <div class="leaderboard-header">
                <h2>üèÜ Leaderboard</h2>
            </div>
            
            <div class="leaderboard-content" id="leaderboardContent">
                <div class="leaderboard-loading">
                    <div class="loading-spinner"></div>
                    <span>Loading leaderboard...</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI Difficulty Selection Modal -->
    <div class="ai-modal-overlay" id="aiModalOverlay">
        <div class="ai-modal">
            <button class="auth-modal-close" id="aiModalClose">&times;</button>
            
            <div class="ai-modal-header">
                <div class="ai-modal-icon">ü§ñ</div>
                <h2>Play vs AI</h2>
                <p class="ai-modal-subtitle">Choose your opponent's difficulty</p>
            </div>
            
            <div class="ai-difficulty-options" id="aiDifficultyOptions">
                <button class="ai-difficulty-btn" data-difficulty="easy">
                    <div class="difficulty-icon">üü¢</div>
                    <div class="difficulty-info">
                        <h3>Easy</h3>
                        <p>Random valid card selection. Great for learning!</p>
                    </div>
                    <div class="difficulty-badge easy">Beginner</div>
                </button>
                
                <button class="ai-difficulty-btn" data-difficulty="medium">
                    <div class="difficulty-icon">üü°</div>
                    <div class="difficulty-info">
                        <h3>Medium</h3>
                        <p>Prioritizes high-point cards. A fair challenge.</p>
                    </div>
                    <div class="difficulty-badge medium">Recommended</div>
                </button>
                
                <button class="ai-difficulty-btn" data-difficulty="hard">
                    <div class="difficulty-icon">üî¥</div>
                    <div class="difficulty-info">
                        <h3>Hard</h3>
                        <p>Strategic play with combos and blocking. Beware!</p>
                    </div>
                    <div class="difficulty-badge hard">Expert</div>
                </button>
            </div>
            
            <div class="ai-modal-loading" id="aiModalLoading" style="display: none;">
                <div class="loading-spinner"></div>
                <span>Starting AI game...</span>
            </div>
        </div>
    </div>
    
    <!-- Auth Gate (Shows before main content) -->
    <div class="auth-gate" id="authGate">
        <div class="auth-gate-content">
            <div class="auth-gate-logo">üêç</div>
            <h1 class="auth-gate-title">Python Card Game</h1>
            <p class="auth-gate-subtitle">A 1v1 syntax card battle</p>
            
            <div class="auth-gate-buttons">
                <button class="auth-gate-btn primary" id="gateLoginBtn">
                    <span class="btn-icon">üîê</span>
                    <span class="btn-label">Login</span>
                </button>
                <button class="auth-gate-btn secondary" id="gateRegisterBtn">
                    <span class="btn-icon">üìù</span>
                    <span class="btn-label">Create Account</span>
                </button>
                <div class="auth-gate-divider">
                    <span>or</span>
                </div>
                <button class="auth-gate-btn ghost" id="gateGuestBtn">
                    <span class="btn-icon">üë§</span>
                    <span class="btn-label">Continue as Guest</span>
                </button>
            </div>
            
            <p class="auth-gate-note">Create an account to track your stats and appear on the leaderboard!</p>
        </div>
    </div>
    
    <!-- Main Content (hidden until auth) -->
    <div id="mainContent" style="display: none;">
    <!-- Floating decorative cards -->
    <div class="floating-cards">
        <div class="floating-card" style="left: 5%; animation-delay: 0s; animation-duration: 25s;"></div>
        <div class="floating-card" style="left: 15%; animation-delay: 3s; animation-duration: 22s;"></div>
        <div class="floating-card" style="left: 25%; animation-delay: 7s; animation-duration: 28s;"></div>
        <div class="floating-card" style="left: 45%; animation-delay: 2s; animation-duration: 20s;"></div>
        <div class="floating-card" style="left: 65%; animation-delay: 5s; animation-duration: 24s;"></div>
        <div class="floating-card" style="left: 75%; animation-delay: 8s; animation-duration: 26s;"></div>
        <div class="floating-card" style="left: 85%; animation-delay: 1s; animation-duration: 23s;"></div>
        <div class="floating-card" style="left: 95%; animation-delay: 4s; animation-duration: 21s;"></div>
    </div>

    <div class="lobby-container">
        <div class="lobby-wrapper">
            <!-- Main Card -->
            <div class="lobby-card">
                <div class="lobby-logo">üêç</div>
                <h1 class="lobby-title">Python Card Game</h1>
                <p class="lobby-subtitle">A 1v1 syntax card battle</p>
                
                <input type="text" 
                       id="playerNameInput" 
                       class="lobby-input" 
                       placeholder="Your name"
                       maxlength="20">
                
                <!-- Quick Match - Most prominent action -->
                <button id="quickMatchBtn" class="lobby-btn quick-match">
                    <span class="quick-match-icon">‚ö°</span>
                    <span class="quick-match-text">Quick Match</span>
                    <span class="quick-match-hint">Auto-join or create game</span>
                </button>
                
                <!-- Play vs AI Button -->
                <button id="playAIBtn" class="lobby-btn ai-match">
                    <span class="ai-match-icon">ü§ñ</span>
                    <span class="ai-match-text">Play vs AI</span>
                    <span class="ai-match-hint">Practice against a bot</span>
                </button>
                
                <div class="lobby-divider">
                    <span>or</span>
                </div>
                
                <button id="createGameBtn" class="lobby-btn primary">
                    Create Private Game
                </button>
                
                <div class="lobby-divider">
                    <span>or join with code</span>
                </div>
                
                <div class="join-row">
                    <input type="text" 
                           id="roomCodeInput" 
                           class="lobby-input" 
                           placeholder="CODE"
                           maxlength="6">
                    <button id="joinGameBtn" class="lobby-btn secondary">Join</button>
                </div>
                
                <div id="statusMessage"></div>
            </div>
            
            <!-- Open Rooms Card -->
            <div class="rooms-card" id="roomsCard">
                <div class="rooms-header">
                    <h3 class="rooms-title">
                        <span class="rooms-icon">üéÆ</span>
                        Open Games
                    </h3>
                    <div class="rooms-refresh" id="roomsRefresh" title="Refreshing automatically">
                        <span class="refresh-dot"></span>
                        <span class="refresh-text">Live</span>
                    </div>
                </div>
                
                <div class="rooms-list" id="roomsList">
                    <div class="rooms-loading">
                        <div class="loading-spinner"></div>
                        <span>Finding open games...</span>
                    </div>
                </div>
                
                <div class="rooms-empty" id="roomsEmpty" style="display: none;">
                    <div class="empty-icon">üîç</div>
                    <div class="empty-text">No open games</div>
                    <div class="empty-hint">Create a game or use Quick Match</div>
                </div>
            </div>
            
            <!-- Rules Card -->
            <div class="rules-card">
                <div class="rules-header">
                    <h3 class="rules-title">How to Play</h3>
                    <button class="tutorial-start-btn" id="lobbyTutorialBtn" title="Interactive Tutorial">
                        <span>üìñ</span> Tutorial
                    </button>
                </div>
                
                <div class="rules-item">
                    <h4>Goal</h4>
                    <p>Highest score when the deck runs out wins! Play Python syntax cards in valid sequences.</p>
                </div>
                
                <div class="rules-item">
                    <h4>Sequences</h4>
                    <p>Cards must follow Python syntax order:<br>
                    <code>for ‚Üí x ‚Üí in ‚Üí range ‚Üí ( ‚Üí 10 ‚Üí ) ‚Üí :</code></p>
                </div>
                
                <div class="rules-item">
                    <h4>Card Types</h4>
                    <p>
                        <span class="card-badge loop">LOOP</span>
                        <span class="card-badge variable">VAR</span>
                        <span class="card-badge keyword">KEY</span>
                        <span class="card-badge function">FUNC</span>
                        <span class="card-badge value">VAL</span>
                        <span class="card-badge operator">OP</span>
                    </p>
                </div>
                
                <div class="rules-item">
                    <h4>Points</h4>
                    <p>Common = 1pt ‚Ä¢ Uncommon = 2pt ‚Ä¢ Rare = 3pt</p>
                </div>
                
                <div class="rules-item">
                    <h4>Special Cards</h4>
                    <p>Draw 2 ‚Ä¢ Skip ‚Ä¢ Wild ‚Äî can be played anytime!</p>
                </div>
            </div>
        </div>
    </div>
    </div><!-- End mainContent -->
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
    
    <style>
        /* Lobby-specific styles */
        .lobby-wrapper {
            display: flex;
            gap: 35px;
            align-items: flex-start;
            animation: fadeInUp 0.6s ease-out;
            width: 100%;
            max-width: 1400px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .lobby-logo {
            font-size: 4.5rem;
            text-align: center;
            margin-bottom: 15px;
            animation: logoFloat 3s ease-in-out infinite;
        }
        
        @keyframes logoFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .card-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
            margin: 3px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease;
        }
        
        .card-badge:hover {
            transform: scale(1.1);
        }
        
        .card-badge.loop { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; }
        .card-badge.variable { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; }
        .card-badge.keyword { background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); color: white; }
        .card-badge.function { background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; }
        .card-badge.value { background: linear-gradient(135deg, #d97706 0%, #b45309 100%); color: white; }
        .card-badge.operator { background: linear-gradient(135deg, #db2777 0%, #be185d 100%); color: white; }
        
        .rules-item code {
            display: inline-block;
            background: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            margin-top: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            border: 1px solid var(--bg-card);
        }
        
        /* Decorative floating cards */
        .floating-cards {
            position: fixed;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: -1;
        }
        
        .floating-card {
            position: absolute;
            width: 40px;
            height: 55px;
            background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-card) 100%);
            border-radius: 6px;
            opacity: 0.15;
            animation: floatCard 20s linear infinite;
        }
        
        @keyframes floatCard {
            0% {
                transform: translateY(100vh) rotate(0deg);
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
            }
        }
        
        /* Large tablets / small laptops - 2 column layout */
        @media (max-width: 1200px) {
            .lobby-wrapper {
                flex-wrap: wrap;
                justify-content: center;
                max-width: 900px;
                margin: 0 auto;
            }
            
            .lobby-card {
                flex: 1 1 380px;
                max-width: 420px;
            }
            
            .rooms-card {
                flex: 1 1 380px;
                max-width: 420px;
            }
            
            .rules-card {
                flex: 1 1 100%;
                max-width: 100%;
                order: 3;
            }
            
            .rules-card .rules-item {
                display: inline-block;
                width: calc(50% - 10px);
                vertical-align: top;
                margin-right: 10px;
            }
        }
        
        /* Tablets - stack all cards */
        @media (max-width: 900px) {
            .lobby-wrapper {
                flex-direction: column;
                align-items: center;
                gap: 25px;
                padding: 10px;
            }
            
            .lobby-card,
            .rooms-card,
            .rules-card {
                max-width: 500px;
                width: 100%;
            }
            
            .rules-card .rules-item {
                display: block;
                width: 100%;
                margin-right: 0;
            }
            
            .lobby-logo {
                font-size: 4rem;
            }
        }
        
        /* Mobile phones */
        @media (max-width: 600px) {
            .lobby-wrapper {
                gap: 20px;
                padding: 5px;
            }
            
            .lobby-card,
            .rooms-card,
            .rules-card {
                max-width: 100%;
                padding: 25px 20px;
                border-radius: 16px;
            }
            
            .lobby-logo {
                font-size: 3.5rem;
                margin-bottom: 10px;
            }
            
            .lobby-title {
                font-size: 1.5rem !important;
            }
            
            .lobby-subtitle {
                font-size: 0.85rem;
                margin-bottom: 25px;
            }
            
            .lobby-input {
                padding: 14px 16px;
                font-size: 0.95rem;
            }
            
            .lobby-btn {
                padding: 14px;
                font-size: 0.95rem;
            }
            
            .lobby-btn.quick-match {
                padding: 16px 14px;
            }
            
            .quick-match-icon {
                font-size: 1.3rem;
            }
            
            .quick-match-text {
                font-size: 1rem;
            }
            
            .lobby-btn.ai-match {
                padding: 14px;
            }
            
            .ai-match-icon {
                font-size: 1.1rem;
            }
            
            .ai-match-text {
                font-size: 0.95rem;
            }
            
            .lobby-divider {
                margin: 20px 0;
            }
            
            .join-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .join-row .lobby-input {
                width: 100%;
                letter-spacing: 3px;
                font-size: 1rem;
            }
            
            .join-row .lobby-btn {
                width: 100%;
                padding: 14px;
            }
            
            /* Rooms card mobile */
            .rooms-card {
                min-height: 200px;
            }
            
            .rooms-header {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .rooms-title {
                font-size: 0.9rem;
            }
            
            .rooms-list {
                max-height: 220px;
            }
            
            .room-item {
                padding: 12px 14px;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .room-info {
                flex: 1;
                min-width: 0;
            }
            
            .room-code {
                font-size: 0.85rem;
            }
            
            .room-players {
                width: 100%;
                justify-content: space-between;
            }
            
            .room-join-btn {
                flex: 1;
                text-align: center;
            }
            
            /* Rules card mobile */
            .rules-header {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .rules-title {
                font-size: 0.95rem;
            }
            
            .tutorial-start-btn {
                padding: 6px 12px;
                font-size: 0.75rem;
            }
            
            .rules-item {
                margin-bottom: 14px;
                padding-left: 12px;
            }
            
            .rules-item h4 {
                font-size: 0.85rem;
            }
            
            .rules-item p {
                font-size: 0.8rem;
            }
            
            .card-badge {
                padding: 2px 8px;
                font-size: 0.65rem;
                margin: 2px;
            }
        }
        
        /* Very small phones */
        @media (max-width: 380px) {
            .lobby-card,
            .rooms-card,
            .rules-card {
                padding: 20px 15px;
            }
            
            .lobby-logo {
                font-size: 3rem;
            }
            
            .lobby-title {
                font-size: 1.3rem !important;
            }
            
            .quick-match-text,
            .ai-match-text {
                font-size: 0.9rem;
            }
            
            .quick-match-hint,
            .ai-match-hint {
                font-size: 0.6rem;
            }
        }
        
        /* Quick Match Button - Prominent green */
        .lobby-btn.quick-match {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 18px 16px;
            position: relative;
            overflow: hidden;
        }
        
        .lobby-btn.quick-match::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, #22c55e, #4ade80, #22c55e);
            border-radius: 14px;
            z-index: -1;
            animation: quickMatchGlow 2s ease-in-out infinite;
        }
        
        @keyframes quickMatchGlow {
            0%, 100% { opacity: 0.5; filter: blur(8px); }
            50% { opacity: 0.8; filter: blur(12px); }
        }
        
        .lobby-btn.quick-match:hover {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(34, 197, 94, 0.5);
        }
        
        .quick-match-icon {
            font-size: 1.5rem;
        }
        
        .quick-match-text {
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .quick-match-hint {
            font-size: 0.7rem;
            opacity: 0.8;
            font-weight: 400;
        }
        
        /* Open Rooms Card */
        .rooms-card {
            background: linear-gradient(145deg, var(--bg-secondary) 0%, rgba(26, 26, 46, 0.95) 100%);
            border: 1px solid var(--bg-tertiary);
            border-radius: 20px;
            padding: 25px;
            max-width: 420px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            min-height: 280px;
            display: flex;
            flex-direction: column;
        }
        
        .rooms-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .rooms-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
        }
        
        .rooms-icon {
            font-size: 1.2rem;
        }
        
        .rooms-refresh {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 5px 12px;
            background: rgba(74, 222, 128, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(74, 222, 128, 0.2);
        }
        
        .refresh-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-green);
            border-radius: 50%;
            animation: pulseDot 1.5s ease-in-out infinite;
        }
        
        @keyframes pulseDot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        .refresh-text {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--accent-green);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .rooms-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            max-height: 280px;
        }
        
        .rooms-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 40px 20px;
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        
        .loading-spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--bg-card);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .rooms-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px 20px;
            text-align: center;
        }
        
        .empty-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        .empty-text {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }
        
        .empty-hint {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        /* Room Item */
        .room-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease;
            animation: roomSlideIn 0.3s ease-out;
        }
        
        @keyframes roomSlideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .room-item:hover {
            background: var(--bg-card);
            border-color: var(--accent-blue);
            transform: translateX(5px);
        }
        
        .room-item.pulse-update {
            animation: roomPulse 0.5s ease;
        }
        
        @keyframes roomPulse {
            0%, 100% { box-shadow: none; }
            50% { box-shadow: 0 0 15px rgba(74, 222, 128, 0.3); }
        }
        
        .room-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .room-code {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 2px;
        }
        
        .room-host {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .host-avatar {
            width: 16px;
            height: 16px;
            background: var(--bg-card);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
        }
        
        .room-players {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .player-count {
            font-size: 0.75rem;
            color: var(--text-muted);
            background: var(--bg-primary);
            padding: 4px 10px;
            border-radius: 10px;
        }
        
        .player-count .current {
            color: var(--accent-blue);
            font-weight: 700;
        }
        
        .room-join-btn {
            padding: 8px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, #3b82f6 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .room-join-btn:hover {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.4);
        }
        
        .room-join-btn:disabled {
            background: var(--bg-card);
            color: var(--text-muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Small loading spinner for buttons */
        .loading-spinner-small {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }
        
        /* Quick Match button loading state */
        .lobby-btn.quick-match:disabled {
            opacity: 0.8;
            cursor: wait;
            flex-direction: row;
            gap: 10px;
        }
        
        .lobby-btn.quick-match:disabled::before {
            display: none;
        }
        
        /* Rooms card update flash effect */
        .rooms-card.updating {
            border-color: var(--accent-green);
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.2);
        }
        
        /* Room item waiting state */
        .room-item.waiting {
            border-color: var(--accent-gold);
            background: rgba(212, 168, 75, 0.05);
        }
        
        .room-item.waiting::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--accent-gold);
            border-radius: 3px 0 0 3px;
        }
        
        /* Play vs AI Button */
        .lobby-btn.ai-match {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 16px 16px;
            position: relative;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .lobby-btn.ai-match::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, #8b5cf6, #a78bfa, #8b5cf6);
            border-radius: 14px;
            z-index: -1;
            animation: aiMatchGlow 2s ease-in-out infinite;
            animation-delay: 1s;
        }
        
        @keyframes aiMatchGlow {
            0%, 100% { opacity: 0.4; filter: blur(8px); }
            50% { opacity: 0.7; filter: blur(12px); }
        }
        
        .lobby-btn.ai-match:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.5);
        }
        
        .ai-match-icon {
            font-size: 1.3rem;
        }
        
        .ai-match-text {
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .ai-match-hint {
            font-size: 0.65rem;
            opacity: 0.8;
            font-weight: 400;
        }
        
        .lobby-btn.ai-match:disabled {
            opacity: 0.8;
            cursor: wait;
        }
        
        .lobby-btn.ai-match:disabled::before {
            display: none;
        }
        
        /* AI Modal Styles */
        .ai-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .ai-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .ai-modal {
            background: linear-gradient(145deg, var(--bg-secondary) 0%, rgba(26, 26, 46, 0.98) 100%);
            border: 1px solid var(--bg-tertiary);
            border-radius: 24px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
            transform: translateY(20px) scale(0.95);
            transition: all 0.3s ease;
        }
        
        .ai-modal-overlay.active .ai-modal {
            transform: translateY(0) scale(1);
        }
        
        .ai-modal-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .ai-modal-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            animation: botFloat 2s ease-in-out infinite;
        }
        
        @keyframes botFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .ai-modal-header h2 {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 8px 0;
        }
        
        .ai-modal-subtitle {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin: 0;
        }
        
        .ai-difficulty-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .ai-difficulty-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 18px;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        
        .ai-difficulty-btn:hover {
            background: var(--bg-card);
            border-color: var(--accent-blue);
            transform: translateX(5px);
        }
        
        .ai-difficulty-btn:active {
            transform: translateX(5px) scale(0.98);
        }
        
        .difficulty-icon {
            font-size: 1.8rem;
            flex-shrink: 0;
        }
        
        .difficulty-info {
            flex: 1;
            min-width: 0;
        }
        
        .difficulty-info h3 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 4px 0;
        }
        
        .difficulty-info p {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin: 0;
            line-height: 1.4;
        }
        
        .difficulty-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
        }
        
        .difficulty-badge.easy {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .difficulty-badge.medium {
            background: rgba(234, 179, 8, 0.15);
            color: #eab308;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }
        
        .difficulty-badge.hard {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        /* Difficulty button hover states */
        .ai-difficulty-btn[data-difficulty="easy"]:hover {
            border-color: #22c55e;
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.2);
        }
        
        .ai-difficulty-btn[data-difficulty="medium"]:hover {
            border-color: #eab308;
            box-shadow: 0 4px 20px rgba(234, 179, 8, 0.2);
        }
        
        .ai-difficulty-btn[data-difficulty="hard"]:hover {
            border-color: #ef4444;
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.2);
        }
        
        .ai-modal-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 30px;
            color: var(--text-muted);
        }
        
        /* AI Modal responsive */
        @media (max-width: 500px) {
            .ai-modal {
                padding: 25px 20px;
                margin: 15px;
                width: calc(100% - 30px);
                max-width: none;
            }
            
            .ai-modal-header h2 {
                font-size: 1.4rem;
            }
            
            .ai-modal-icon {
                font-size: 2.5rem;
            }
            
            .ai-difficulty-btn {
                padding: 14px 15px;
                gap: 12px;
            }
            
            .difficulty-icon {
                font-size: 1.5rem;
            }
            
            .difficulty-info h3 {
                font-size: 0.95rem;
            }
            
            .difficulty-info p {
                font-size: 0.7rem;
            }
            
            .difficulty-badge {
                padding: 3px 8px;
                font-size: 0.6rem;
            }
        }
        
        /* Rules card header with tutorial button */
        .rules-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .rules-header .rules-title {
            margin: 0;
        }
        
        .tutorial-start-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, var(--accent-gold) 0%, #b8860b 100%);
            border: none;
            border-radius: 8px;
            color: var(--bg-primary);
            font-weight: 600;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 3px 12px rgba(212, 168, 75, 0.3);
        }
        
        .tutorial-start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 168, 75, 0.4);
        }
        
        .tutorial-start-btn:active {
            transform: translateY(0);
        }
        
        /* Lobby Tutorial Modal Overlay */
        .lobby-tutorial-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .lobby-tutorial-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Lobby Tutorial Modal */
        .lobby-tutorial-modal {
            background: linear-gradient(145deg, var(--bg-secondary) 0%, rgba(26, 26, 46, 0.98) 100%);
            border: 2px solid var(--accent-gold);
            border-radius: 24px;
            padding: 35px 40px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5), 0 0 60px rgba(212, 168, 75, 0.15);
            transform: translateY(20px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .lobby-tutorial-overlay.active .lobby-tutorial-modal {
            transform: translateY(0) scale(1);
        }
        
        .lobby-tutorial-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .lobby-tutorial-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: tutorialIconFloat 2s ease-in-out infinite;
        }
        
        @keyframes tutorialIconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .lobby-tutorial-header h2 {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-primary);
            margin: 0 0 10px 0;
        }
        
        .lobby-tutorial-header p {
            font-size: 1rem;
            color: var(--text-muted);
            margin: 0;
        }
        
        /* Tutorial Steps */
        .lobby-tutorial-steps {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .lobby-tutorial-step {
            display: flex;
            gap: 18px;
            padding: 20px;
            background: var(--bg-tertiary);
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease;
        }
        
        .lobby-tutorial-step:hover {
            border-color: var(--accent-gold);
            background: var(--bg-card);
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-gold) 0%, #b8860b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--bg-primary);
            flex-shrink: 0;
        }
        
        .step-content h4 {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 8px 0;
        }
        
        .step-content p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.5;
        }
        
        .step-content code {
            background: var(--bg-primary);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8rem;
            color: var(--accent-green);
        }
        
        /* Card Types Preview in Tutorial */
        .tutorial-cards-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .tutorial-card-type {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
        }
        
        .tutorial-card-type.loop { background: linear-gradient(135deg, #dc2626, #991b1b); }
        .tutorial-card-type.variable { background: linear-gradient(135deg, #2563eb, #1d4ed8); }
        .tutorial-card-type.keyword { background: linear-gradient(135deg, #7c3aed, #5b21b6); }
        .tutorial-card-type.function { background: linear-gradient(135deg, #059669, #047857); }
        .tutorial-card-type.value { background: linear-gradient(135deg, #d97706, #b45309); }
        .tutorial-card-type.special { background: linear-gradient(135deg, #d4a84b, #b8860b); }
        
        /* Tutorial Footer */
        .lobby-tutorial-footer {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .tutorial-close-btn {
            padding: 14px 35px;
            background: linear-gradient(135deg, var(--accent-green) 0%, #16a34a 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 20px rgba(74, 222, 128, 0.3);
        }
        
        .tutorial-close-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(74, 222, 128, 0.4);
        }
        
        /* Tutorial Modal responsive */
        @media (max-width: 650px) {
            .lobby-tutorial-modal {
                padding: 25px 20px;
                margin: 15px;
                width: calc(100% - 30px);
                max-width: none;
                max-height: 90vh;
            }
            
            .lobby-tutorial-header h2 {
                font-size: 1.4rem;
            }
            
            .lobby-tutorial-icon {
                font-size: 3rem;
            }
            
            .lobby-tutorial-step {
                padding: 15px;
                gap: 14px;
            }
            
            .step-number {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            
            .step-content h4 {
                font-size: 0.95rem;
            }
            
            .step-content p {
                font-size: 0.85rem;
            }
            
            .tutorial-cards-preview {
                gap: 6px;
            }
            
            .tutorial-card-type {
                padding: 4px 10px;
                font-size: 0.7rem;
            }
            
            .tutorial-close-btn {
                padding: 12px 28px;
                font-size: 0.95rem;
            }
        }
        
        @media (max-width: 400px) {
            .lobby-tutorial-modal {
                padding: 20px 15px;
            }
            
            .lobby-tutorial-header h2 {
                font-size: 1.2rem;
            }
            
            .lobby-tutorial-icon {
                font-size: 2.5rem;
                margin-bottom: 10px;
            }
            
            .lobby-tutorial-steps {
                gap: 15px;
            }
            
            .lobby-tutorial-step {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .step-number {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
        }
        
        /* Profile Modal responsive */
        @media (max-width: 500px) {
            .profile-modal,
            .leaderboard-modal {
                padding: 25px 20px;
                margin: 15px;
                width: calc(100% - 30px);
                max-width: none;
            }
            
            .profile-stats {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .profile-stats .stat-item {
                flex: 1 1 40%;
            }
        }
        
        /* Auth Modal responsive */
        @media (max-width: 500px) {
            .auth-modal {
                padding: 25px 20px;
                margin: 15px;
                width: calc(100% - 30px);
                max-width: none;
            }
            
            .auth-tabs {
                flex-direction: column;
                gap: 8px;
            }
            
            .auth-tab {
                padding: 12px 20px;
            }
        }
    </style>
    
    <!-- Lobby Tutorial Modal -->
    <div class="lobby-tutorial-overlay" id="lobbyTutorialOverlay">
        <div class="lobby-tutorial-modal">
            <div class="lobby-tutorial-header">
                <div class="lobby-tutorial-icon">üêç</div>
                <h2>How to Play Python Card Game</h2>
                <p>Learn the basics in 2 minutes!</p>
            </div>
            
            <div class="lobby-tutorial-steps">
                <div class="lobby-tutorial-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>The Goal</h4>
                        <p>Build valid Python code by playing syntax cards! The player with the <strong>highest score</strong> when the deck runs out wins.</p>
                    </div>
                </div>
                
                <div class="lobby-tutorial-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Card Types</h4>
                        <p>Each card represents Python syntax. Cards are color-coded:</p>
                        <div class="tutorial-cards-preview">
                            <span class="tutorial-card-type loop">Loop</span>
                            <span class="tutorial-card-type variable">Variable</span>
                            <span class="tutorial-card-type keyword">Keyword</span>
                            <span class="tutorial-card-type function">Function</span>
                            <span class="tutorial-card-type value">Value</span>
                            <span class="tutorial-card-type special">Special</span>
                        </div>
                    </div>
                </div>
                
                <div class="lobby-tutorial-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Playing Cards</h4>
                        <p>Cards must follow valid Python syntax. For example: <code>for i in range(10):</code></p>
                        <p style="margin-top: 8px;">You can insert cards <strong>anywhere</strong> in the sequence using the + icons!</p>
                    </div>
                </div>
                
                <div class="lobby-tutorial-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Scoring Points</h4>
                        <p><strong>Common (1pt):</strong> Variables, Values, Operators<br>
                        <strong>Uncommon (2pt):</strong> Loops, Functions, Keywords<br>
                        <strong>Rare (3pt):</strong> def, return, class</p>
                    </div>
                </div>
                
                <div class="lobby-tutorial-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h4>Special Cards & Powers</h4>
                        <p><strong>Wild</strong> - Plays as any category<br>
                        <strong>Skip</strong> - Skip opponent's turn<br>
                        <strong>Draw 2</strong> - Opponent draws 2 cards<br><br>
                        Every <strong>5 turns</strong>, you earn a special power!</p>
                    </div>
                </div>
                
                <div class="lobby-tutorial-step">
                    <div class="step-number">6</div>
                    <div class="step-content">
                        <h4>Game Modes</h4>
                        <p><strong>‚ö° Quick Match</strong> - Auto-join an open game or create one<br>
                        <strong>ü§ñ Play vs AI</strong> - Practice against a bot (Easy/Medium/Hard)<br>
                        <strong>Private Game</strong> - Create a room and share the code</p>
                    </div>
                </div>
            </div>
            
            <div class="lobby-tutorial-footer">
                <button class="tutorial-close-btn" id="closeLobbyTutorial">Got it! Let's Play!</button>
            </div>
        </div>
    </div>
    
    <script>
        // Lobby Tutorial Handler
        document.addEventListener('DOMContentLoaded', function() {
            const tutorialBtn = document.getElementById('lobbyTutorialBtn');
            const tutorialOverlay = document.getElementById('lobbyTutorialOverlay');
            const closeBtn = document.getElementById('closeLobbyTutorial');
            
            if (tutorialBtn && tutorialOverlay) {
                // Open tutorial
                tutorialBtn.addEventListener('click', function() {
                    tutorialOverlay.classList.add('active');
                });
                
                // Close tutorial
                closeBtn?.addEventListener('click', function() {
                    tutorialOverlay.classList.remove('active');
                });
                
                // Close on overlay click
                tutorialOverlay.addEventListener('click', function(e) {
                    if (e.target === tutorialOverlay) {
                        tutorialOverlay.classList.remove('active');
                    }
                });
                
                // Close on Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && tutorialOverlay.classList.contains('active')) {
                        tutorialOverlay.classList.remove('active');
                    }
                });
            }
        });
    </script>
</body>
</html>
